<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>

	    <record id="openstc_res_company_inherit_main_form" model="ir.ui.view">
            <field name="name">res.company.inherit.form</field>
            <field name="model">res.company</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="base.view_company_form"/>
            <field name="arch" type="xml">
				<page string="Configuration" position="inside">
                	<separator string="Préférences de la Collectivité" colspan="4">
				    	<group colspan="4" col="6">
							
				    	</group>
				    </separator>
				</page>
	   		</field>
	   	</record>
	    
	    
		<!-- Vue Produits mère pour l'ensemble du projet OpenStock -->
		<record model="ir.ui.view" id="view_openstock_fournitures_tree">
			<field name="name">fourniture.product.tree</field>
			<field name="model">product.product</field>
			<field name="inherit_id" ref="product.product_product_tree_view" />
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree colors="red:virtual_available&lt;0;blue:virtual_available&gt;=0 and state in ('draft', 'end', 'obsolete');black:virtual_available&gt;=0 and state not in ('draft', 'end', 'obsolete')" 
					string="Products" position="replace">
					<tree string="Produits">
						<field name="name" />
						<field name="list_price" />
						<field name="seuil_confirm" />
					</tree>
				</tree>
			</field>
		</record>

		<record model="ir.ui.view" id="view_openstock_fournitures_form">
			<field name="name">fourniture.product.form</field>
			<field name="model">product.product</field>
			<field name="inherit_id" ref="stock.view_normal_stock_property_form" />
			<field name="type">form</field>
			<field name="arch" type="xml">
				<field name="virtual_available" position="after">
					<field name="seuil_confirm" />
				</field>
				<field name="purchase_ok" position="after">
				    <field name="bloquant"/>
				    <field name="empruntable"/>
				</field>
			</field>
		</record>
		
		<record model="ir.ui.view" id="view_openstock_fournitures_checkout_form">
			<field name="name">fourniture.product.checkout.form</field>
			<field name="model">product.product</field>
			<field name="inherit_id" ref="product.product_normal_form_view" />
			<field name="type">form</field>
			<field name="arch" type="xml">
				<page string="Suppliers" position="before">
					<page string="Résumé des Détériorations">
				    	<field name="checkout_lines" nolabel="1">
					        <tree string="Résumé des détériorations (Etat des Lieux)" editable="top"
					            colors="blue:state=='draft' and etat_retour=='to_repair';orange:state=='draft' and etat_retour=='to_purchase';
					            green:state=='in_progress'">
					            <field name="checkout_id"/>
					            <field name="date_order"/>
					            <field name="etat_retour"/>
					            <field name="infos_supp"/>
					            <field name="qte_to_purchase"/>
					            <field name="partner_id"/>
					            <field name="state"/>
					        </tree>
					    </field>
					</page>
				</page>
			</field>
		</record>
		
		<!-- Vues Réservation d'articles -->
		<record model="ir.ui.view" id="view_openstock_reservation_form">
			<field name="name">open.pret_location.reservation.form</field>
			<field name="model">hotel.reservation</field>
			<field name="inherit_id" ref="hotel_reservation.view_hotel_reservation_form" />
			<field name="type">form</field>
			<field name="arch" type="xml">
				<field name="reservation_no" position="after">
					<field name="name" attrs="{'readonly':[('state','in',('in_use','done'))]}"/>
				</field>
				<field name="date_order" select="1" position="replace">
					<field name="date_order" string="Date de création" select="1"
						attrs="{'invisible':[('state','=','remplir')],'required':[('state','&lt;&gt;','remplir')]}" />
				</field>
				<field name="shop_id" select="2" position="replace">
					<field name="shop_id" string="Magasin" select="2" position="replace"
						attrs="{'invisible':[('state','=','remplir')],'required':[('state','&lt;&gt;','remplir')],'readonly':[('state','in',('in_use','done'))]}" />
				</field>
				<field name="pricelist_id" position="replace">
					<field name="pricelist_id" string="Liste de prix"
						attrs="{'invisible':[('state','=','remplir')],'required':[('state','&lt;&gt;','remplir')],'readonly':[('state','in',('in_use','done'))]}" />
				</field>
				<field name="partner_id" on_change="onchange_partner_id(partner_id)"
					select="1" position="replace">
					<field name="openstc_partner_id" on_change="onchange_openstc_partner_id(openstc_partner_id)"
					    attrs="{'required':[('state','in',('confirm','draft'))],'invisible':[('state','=','remplir')],'readonly':[('state','not in',('confirm','draft'))]}"/>
					
					<field name="partner_id" string="Demandeur"
						on_change="onchange_partner_id(partner_id)" select="1" invisible="1"
						attrs="{'required':[('state','&lt;&gt;','remplir')],'readonly':[('state','in',('in_use','done'))]}" />
					
					<field name="partner_mail" attrs="{'invisible':[('state','=','remplir')]}" />
					<field name="site_id"/>
				</field>
				<field name="partner_order_id" domain="[('partner_id','=',partner_id)]"
					position="replace">
					<field name="partner_order_id" string="Adresse de Commande"
						domain="[('partner_id','=',partner_id)]"
						attrs="{'invisible':[('state','&lt;&gt;',False)],'required':[('state','&lt;&gt;','remplir')],'readonly':[('state','in',('in_use','done'))]}" />
				</field>
				<field name="partner_invoice_id" domain="[('partner_id','=',partner_id)]"
					position="replace">
					<field name="partner_invoice_id" string="Adresse de facturation"
						domain="[('partner_id','=',partner_id)]"
						attrs="{'invisible':[('state','&lt;&gt;',False)],'required':[('state','&lt;&gt;','remplir')],'readonly':[('state','in',('in_use','done'))]}" />
				</field>
				<field name="partner_shipping_id" domain="[('partner_id','=',partner_id)]"
					position="replace">
					<field name="partner_shipping_id" string="Adresse de Livraison"
						domain="[('partner_id','=',partner_id)]"
						attrs="{'invisible':[('state','=','remplir')],'required':[('state','&lt;&gt;','remplir')],'readonly':[('state','in',('in_use','done'))]}" 
						/>
				</field>
				<field name="adults" position="replace" />
				<field name="childs" position="replace" />
				<field name="checkin" colspan="1" position="replace">
					<field name="checkin" string="Début de la Réservation"
						colspan="1" attrs="{'readonly':[('state','&lt;&gt;','remplir')]}" />
				</field>
				<field name="checkout" on_change="on_change_checkout(checkin,checkout)"
					position="replace">
					<field name="checkout" string="Fin de la Réservation"
						on_change="on_change_checkout(checkin,checkout)"
						attrs="{'readonly':[('state','&lt;&gt;','remplir')]}" />
				</field>
				
				<field name="state" position="after">
					<field name="in_option" on_change="onchange_in_option(in_option,state)" />
				</field>
				
				<field name="reservation_line" colspan="4" nolabel="1"
					position="replace">
					<field name="reservation_line" string="Lignes de Réservation" required="1" colspan="4"
					     nolabel="1" attrs="{'readonly':[('state','not in',('remplir', 'draft','wait_confirm'))]}">
						<tree string="Ligne de réservation" editable="top">
							<field name="categ_id" required="1" attrs="{'readonly':[('state','&lt;&gt;','remplir')]}" />
							<field name="reserve_product" colspan="1"
								domain="[('categ_id','=',categ_id)]" required="1" attrs="{'readonly':[('state','&lt;&gt;','remplir')]}" />
							<field name="qte_reserves" attrs="{'readonly':[('state','&lt;&gt;','remplir')]}" />
							<field name="prix_unitaire" attrs="{'readonly':[('state','&lt;&gt;','wait_confirm')]}"/>
							<field name="dispo" readonly="1"/>
							<field name="infos"/>
							<field name="no_infos"/>
							<field name="valide"/>
							<field name="state"/>
						</tree>
					</field>
				</field>
				<button name="done" string="Create Folio" states="confirm"
					position="replace">
					<button name="%(action_view_openstc_pret_create_checkout)d" string="Retour des articles" type="action" states="in_use" />
					<!-- <button name="create_folio" type="object" string="Générer Folio" states="done"/> -->
				</button>
				<button name="confirm" string="Confirm" states="draft"
					position="replace">
					<group colspan="1" col="2">
						<button name="compute_lines_price" type="object" string="Calculer prix" states="draft" icon="gtk-execute" />
						<button name="confirm" string="Valider la réservation" states="draft,wait_confirm" icon="gtk-go-forward"/>
					    <button name="redraft" string="Recommencer la réservation" states="cancle" />
						<button name="to_draft" string="Suivant" states="remplir" icon="gtk-go-forward"/>
						<button name="verif_dispo" type="object" string="Vérifier Disponibilités" states="remplir" icon="gtk-execute"/>
						<button name="%(action_view_openstc_pret_deliver_products_wizard)d" type="action" string="Mettre à Disposition les articles" states="confirm" icon="gtk-go-forward"/>
						<button name="back_to_remplir" string="Modifier la réservation" icon="gtk-go-back" states="draft"/>
						<button name="%(action_view_openstc_pret_create_envoi_mail_annulation_wizard)d" string="Refuser la réservation" type="action" states="draft,confirm" icon="gtk-cancel"/>
					</group>
				</button>
				<page string="Reservation" position="after">
				    <page string="Folios Associés">
				        <field name="folio_id"/>
				    </page>
				</page>
			</field><!-- end tag of xml arch -->
		</record>

		<record model="ir.ui.view" id="view_openstock_reservation_tree">
			<field name="name">hotel.reservation.tree</field>
			<field name="model">hotel.reservation</field>
			<field name="inherit_id" ref="hotel_reservation.view_hotel_reservation_tree" />
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<field name="reservation_no" position="replace">
					<field name="name" />
					<field name="reservation_no" string="N° Réservation" />
				</field>
				<field name="partner_id" select="1" position="replace">
					<field name="partner_id" select="1" string="Demandeur" />
				</field>
				<field name="checkin" position="replace">
					<field name="checkin" string="Date de début Réservation" />
				</field>
				<field name="checkout" position="replace">
					<field name="checkout" string="Date de fin Réservation" />
				</field>
			</field>
		</record>

		<record model="ir.ui.view" id="view_openstock_reservation_folio_form">
			<field name="name">open.pret_location.reservation.form</field>
			<field name="model">hotel.folio</field>
			<field name="inherit_id" ref="hotel.view_hotel_folio1_form" />
			<field name="type">form</field>
			<field name="arch" type="xml">
				<!-- @TODO: Rajouter <form> parent pour que les modifs soient prises 
					en compte <field name="checkin_date" position="replace"> <field name="checkin_date" 
					string="Date de début de Réservation"/> </field> <field name="checkout_date" 
					on_change="on_change_checkout(checkin_date,checkout_date)" position="replace"> 
					<field name="checkout_date" on_change="on_change_checkout(checkin_date,checkout_date)" 
					string="Date de fin de Réservation"/> </field> <field name="product_uom_qty" 
					on_change="product_id_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 
					'lang' in context and context['lang'], False, parent.date_order)" context="{'partner_id':'parent.partner_id','quantity':'product_uom_qty','pricelist':'parent.pricelist_id','shop':'parent.shop_id','uom':'product_uom'}" 
					invisible="1" position="replace"> <field name="product_uom_qty" on_change="product_id_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 
					'lang' in context and context['lang'], False, parent.date_order)" context="{'partner_id':'parent.partner_id','quantity':'product_uom_qty','pricelist':'parent.pricelist_id','shop':'parent.shop_id','uom':'product_uom'}" 
					invisible="1" string="Quantité réservée"/> </field> <field name="product_uom" 
					on_change="product_uom_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 
					'lang' in context and context['lang'], False, parent.date_order)" string="Rent(UOM)" 
					position="replace"> <field name="product_uom" on_change="product_uom_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 
					'lang' in context and context['lang'], False, parent.date_order)" string="Unité 
					de Mesure"/> </field> -->
				<field name="service_lines" colspan="4" string="Service Line"
					nolabel="1" position="replace" />
				<field name="room_lines" colspan="4"
					default_get="{'checkin_date': checkin_date,'checkout_date':checkout_date}"
					nolabel="1" position="replace">
					<field name="room_lines" colspan="4"
						default_get="{'checkin_date': checkin_date,'checkout_date':checkout_date}"
						nolabel="1">
						<tree string="Articles Réservés">
							<field name="name" />
							<field name="checkin_date" string="Date de début de Réservation" />
							<field name="checkout_date" string="Date de fin de Réservation" />
							<field name="product_id" string="Article Réservé" />
							<field name="product_uom_qty" string="Quantité Réservée" />
							<field name="price_unit" string="Prix Unitaire" />
							<field name="price_subtotal" />
						</tree>
					</field>
				</field>
				<field name="partner_id" on_change="onchange_partner_id(partner_id)"
					required="1" string="Guest Name" colspan="4" position="replace">
					<field name="partner_id" on_change="onchange_partner_id(partner_id)"
						required="1" string="Demandeur" colspan="4"/>
				</field>
				<field name="partner_order_id" domain="[('partner_id','=',partner_id)]"
					string="Booking Contact" position="replace">
					<field name="partner_order_id" domain="[('partner_id','=',partner_id)]"
						string="Contact demandeur" />
				</field>
				<field name="name" colspan="1" string="Folio No" position="replace">
					<field name="name" colspan="1" string="N° Folio" />
				</field>
				<field name="shop_id" string="Branch" position="replace">
					<field name="shop_id" string="Magasin" />
				</field>
				<field name="duration" on_change="onchange_dates(checkin_date,False,duration)"
					position="replace" />
				<button name="button_dummy" string="Compute" states="draft"
					type="object" position="replace">
					<button name="button_dummy" string="Calculer" states="draft"
						type="object" />
				</button>
				<button name="order_confirm" string="Confirm Folio" states="draft"
					position="replace">
					<button name="order_confirm" string="Confirmer Folio"
						states="draft" />
				</button>
				<button name="invoice_recreate" string="Recreate Invoice"
					states="invoice_except" position="replace">
					<button name="invoice_recreate" string="Recreate Invoice"
						states="Recréer facture" />
				</button>
				<button name="invoice_corrected" string="Invoice Corrected"
					states="invoice_except" position="replace">
					<button name="invoice_corrected" string="Facture corrigée"
						states="invoice_except" />
				</button>
				<button name="ship_recreate" string="Recreate Procurement"
					states="shipping_except" position="replace">
					<button name="ship_recreate" string="Recréer Approvisionnement"
						states="shipping_except" />
				</button>
				<button name="ship_corrected" string="Procurement Corrected"
					states="shipping_except" position="replace">
					<button name="ship_corrected" string="Approvisionnement Corrigé"
						states="shipping_except" />
				</button>
				<button name="manual_invoice" states="manual" string="Create Invoice"
					position="replace">
					<button name="manual_invoice" states="manual" string="Créer Facture" />
				</button>
				<button name="ship_cancel" string="Cancel Folio" states="shipping_except"
					position="replace">
					<button name="ship_cancel" string="Annuler Folio" states="shipping_except" />
				</button>
				<button name="action_cancel_draft" states="cancel" string="Set to Draft"
					type="object" position="replace">
					<button name="action_cancel_draft" states="cancel"
						string="Mettre en Brouillon" type="object" />
				</button>
				<button name="action_cancel" string="Cancel Folio" states="manual,progress"
					type="object" position="replace">
					<button name="action_cancel" string="Annuler Folio" states="manual,progress"
						type="object" />
				</button>
				<button name="cancel" string="Cancel Folio" states="draft"
					position="replace">
					<button name="cancel" string="Annuler Folio" states="draft" />
				</button>
				<button name="invoice_cancel" string="Cancel Folio" states="invoice_except"
					position="replace">
					<button name="invoice_cancel" string="Annuler Folio" states="invoice_except" />
				</button>
			</field><!-- end tag of xml arch -->
		</record>

		<record model="ir.ui.view" id="view_openstock_reservation_calendar">
			<field name="name">hotel.reservation.calendar</field>
			<field name="model">hotel.reservation</field>
			<field name="inherit_id" ref="hotel_reservation.hotel_calendar_view"/>
			<field name="type">calendar</field>
			<field name="arch" type="xml">
				<xpath expr="//calendar" position="replace">
					<calendar string="Planning des Réservations" color="site_id" date_start="checkin" date_stop="checkout" day_length="24" mode="week">
					    <field name="name"/>
					    <field name="partner_id"/>
					    <field name="site_id"/>
					</calendar>
				</xpath>
			</field>
		</record>
		
		<record model="ir.ui.view" id="view_openstock_reservation_folio1_tree">
			<field name="name">hotel.folio.tree</field>
			<field name="inherit_id" ref="hotel.view_hotel_folio1_tree" />
			<field name="model">hotel.folio</field>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<field name="checkin_date" position="replace">
					<field name="checkin_date" string="Date de début Réservation" />
				</field>
				<field name="checkout_date" position="replace">
					<field name="checkout_date" string="Date de fin Réservation" />
				</field>
			</field>
		</record>

		<record model="ir.ui.view" id="view_openstc_pret_voir_emprunt_ext">
			<field name="name">purchase.order.emprunt.form</field>
			<field name="model">purchase.order</field>
			<field name="inherit_id" ref="purchase.purchase_order_form" />
			<field name="type">form</field>
			<field name="arch" type="xml">
				<field name="invoiced" position="after">
				    <field name="is_emprunt"/>
				</field>
				<button name="action_cancel" states="approved,except_picking,except_invoice,wait" string="Cancel Purchase Order" type="object" icon="gtk-cancel" position="replace">
					<button name="action_cancel" attrs="{'invisible':['|',('is_emprunt','=',True),('state','not in',('approved','except_picking','except_invoice','wait'))]}" string="Cancel Purchase Order" type="object" icon="gtk-cancel"/>
					<button name="do_terminate_emprunt" type="object" attrs="{'invisible':['|',('is_emprunt','=',False),('state','&lt;&gt;','approved')]}" string="Renvoyer articles à la collecticité" icon="gtk-ok"/>
					<button name="purchase_cancel" attrs="{'invisible':['|',('is_emprunt','=',False),('state','&lt;&gt;','except_picking')]}" string="Annuler emprunt" icon="gtk-cancel"/>
				</button>
			</field>
		</record>

		<record model="ir.ui.view" id="view_openstc_all_reservations_search_view">
			<field name="name">openstc.pret.reservation.all</field>
			<field name="model">hotel.reservation</field>
			<field name="type">search</field>
			<field name="arch" type="xml">
				<search string="Réservations">
					<filter string="En cours de Confirmation" domain="[('state','in',('remplir','draft','wait_confirm'))]" help="Réservations en cours de traitement, elles sont soit en Brouillon, soit en attente de validation."/>
					<filter string="En Attente de mise a dispo" domain="[('state','in',('confirm',))]" help="Réservations validées, le demandeur a été notifié que sa demande est confirmée, il faudra procéder A la mise A disposition des ressources."/>
					<filter string="En cours d'utilisation" domain="[('state','in',('in_use',))]" help="Le demandeur est en train d'utiliser les articles empruntés"/>
					<filter string="Terminées" domain="[('state','in',('done',))]" help="Réservations cloturées ou annulées"/>
					<filter string="Litigieuses" domain="['|',('state','in',('cancle',)),('in_option','=','block')]" help="Réservations annulées ou bloquées pour cause de non disponibilité des articles"/>
					<newline />
					<filter string="Voir seulement les Salles" domain="[('reservation_line.reserve_product.is_salle','=',True)]"
					    help="n'affiche que les réservations concernant une salle"/>
					<field name="prod_id" string="Ressource" widget="selection"
					    filter_domain="[('reservation_line.reserve_product','=',self)]"/>
				</search>
			</field>
		</record>
		
		<!-- Actions Prêts/Locations -->
		<record id="action_openstock_pret_location_view_product" model="ir.actions.act_window">
			<field name="name">Prêts / Locations</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">product.product</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree</field>
		</record>

		<record id="action_open_pret_location_reservation_create_form"
			model="ir.actions.act_window">
			<field name="name">Réserver article(s)</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">hotel.reservation</field>
			<field name="view_type">form</field>
			<field name="view_mode">form</field>
			<field name="src_model">product.product</field>
			<field name="view_id" ref="hotel_reservation.view_hotel_reservation_form" />
			<field name="target">current</field>
			<field name="context">{'from_product':'1', 'product_ids':active_ids}</field>
		</record>

		<record id="action_openstc_pret_resa_semaine_view" model="ir.actions.act_window">
			<field name="name">Réservations de la semaine à traiter</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">hotel.reservation</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
			<field name="domain">[('state','not in',('cancle','done'))]</field>
			<field name="context">{'resa_semaine':1}</field>
			<field name="target">current</field>
		</record>
		
		<record id="action_open_pret_location_reservation_create_values" model="ir.values">
			<field name="name">Réserver article(s)</field>
			<field name="key2">client_action_multi</field>
			<field eval="1" name="object"/>
			<field name="value" eval="'ir.actions.act_window,' + str(ref('action_open_pret_location_reservation_create_form'))" />
			<field name="key">action</field>
			<field name="model">product.product</field>
		</record>

		<!-- calendar views -->


		
	</data>
</openerp>