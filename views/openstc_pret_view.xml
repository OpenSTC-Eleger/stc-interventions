<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>

	    <record id="openstc_res_company_inherit_main_form" model="ir.ui.view">
            <field name="name">res.company.inherit.form</field>
            <field name="model">res.company</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="base.view_company_form"/>
            <field name="arch" type="xml">
				<page string="Configuration" position="inside">
                	<separator string="Préférences de la Collectivité" colspan="4">
				    	<group colspan="4" col="6">
							
				    	</group>
				    </separator>
				</page>
	   		</field>
	   	</record>


	<!-- Vue Produits mère pour l'ensemble du projet OpenStock -->
		<record model="ir.ui.view" id="view_openstock_fournitures_tree">
			<field name="name">fourniture.product.tree</field>
			<field name="model">product.product</field>
			<field name="inherit_id" ref="product.product_product_tree_view" />
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree colors="red:virtual_available&lt;0;blue:virtual_available&gt;=0 and state in ('draft', 'end', 'obsolete');black:virtual_available&gt;=0 and state not in ('draft', 'end', 'obsolete')" 
					string="Products" position="replace">
					<tree string="Produits">
						<field name="name" />
						<field name="list_price" />
						<field name="seuil_confirm"/>
					</tree>
				</tree>
			</field>
		</record>

		<record model="ir.ui.view" id="view_openstock_fournitures_form">
			<field name="name">fourniture.product.form</field>
			<field name="model">product.product</field>
			<field name="inherit_id" ref="stock.view_normal_stock_property_form" />
			<field name="type">form</field>
			<field name="arch" type="xml">
				<field name="purchase_ok" position="after">
				    <field name="bloquant"/>
				    <field name="empruntable"/>
				</field>
				<page string="Information" position="after">
				    <page string="Collectivités">
						<field name="seuil_confirm" required="1"/>
						<field name="service_technical_id"/>
						<field name="type_prod"/>
						<field name="openstc_reservable"/>
						<field name="openstc_maintenance"/>
					</page>
			</page>
			</field>
		</record>
		
		<record model="ir.ui.view" id="view_openstock_fournitures_checkout_form">
			<field name="name">fourniture.product.checkout.form</field>
			<field name="model">product.product</field>
			<field name="inherit_id" ref="product.product_normal_form_view" />
			<field name="type">form</field>
			<field name="arch" type="xml">
				<page string="Suppliers" position="before">
					<page string="Résumé des Détériorations">
				    	<field name="checkout_lines" nolabel="1">
					        <tree string="Résumé des détériorations (Etat des Lieux)" editable="top"
					            colors="blue:state=='draft' and qte_to_repair > 0.0;orange:state=='draft' and qte_to_purchase > 0.0;
					            green:state=='in_progress'">
					            <field name="checkout_id"/>
					            <field name="date_order"/>
					            <field name="qte_to_repair"/>
					            <field name="infos_supp"/>
					            <field name="qte_to_purchase"/>
					            <field name="partner_id"/>
					            <field name="state"/>
					        </tree>
					    </field>
					</page>
				</page>
			</field>
		</record>
		
		<!-- Vues Réservation d'articles -->
		<record model="ir.ui.view" id="view_openstock_reservation_form">
			<field name="name">open.pret_location.reservation.form</field>
			<field name="model">hotel.reservation</field>
			<field name="inherit_id" ref="hotel_reservation.view_hotel_reservation_form" />
			<field name="type">form</field>
			<field name="arch" type="xml">
			    <form position="replace">
				    <form string="Réservation de Ressources">
				        <notebook>
					        <page string="Réservation">
						        <group col="4" colspan="4" string="Infos Générales">
							        <field name="reservation_no" required="1" attrs="{'readonly':[('state','&lt;&gt;','remplir')]}"/>
							        <field name="date_order" required="1" attrs="{'readonly':[('state','&lt;&gt;','remplir')]}"/>
						        </group>
						        <group col="2" colspan="2" string="Coordonnées Demandeur">
						            <field name="openstc_partner_id" required="1" on_change="onchange_openstc_partner_id(openstc_partner_id)"
						                attrs="{'readonly':[('state','&lt;&gt;','remplir')]}" domain="[('customer','=',True),('technical_service_id','=',False),('technical_site_id','=',False)]"/>
						            <field name="partner_id" invisible="1" on_change="onchange_partner_id(partner_id)"
						                attrs="{'readonly':[('state','&lt;&gt;','remplir')]}"/>
						            <field name="partner_shipping_id" on_change="onchange_partner_shipping_id(partner_shipping_id)"
						                attrs="{'readonly':[('state','&lt;&gt;','remplir')]}"/>
						            <field name="partner_order_id" invisible="1"
						                attrs="{'readonly':[('state','&lt;&gt;','remplir')]}"/>
						            <field name="partner_invoice_id" invisible="1"
						                attrs="{'readonly':[('state','&lt;&gt;','remplir')]}"/>
						            <group colspan="2" col="4">
						            	<field name="partner_mail" attrs="{'readonly':[('state','&lt;&gt;','remplir')]}"/>
									</group>
   						            <field name="pricelist_id" attrs="{'readonly':[('state','&lt;&gt;','remplir')]}"/>
						        </group>
						        <group col="2" colspan="2" string="Infos de la Réservation">
						            <field name="name" required="1" attrs="{'readonly':[('state','&lt;&gt;','remplir')]}"/>
							        <field name="site_id" required="1" attrs="{'readonly':[('state','&lt;&gt;','remplir')]}"/>
					                <field name="checkin" required="1" attrs="{'readonly':[('state','&lt;&gt;','remplir')]}"/>
					            	<field name="checkout" required="1" attrs="{'readonly':[('state','&lt;&gt;','remplir')]}"/>    
						        </group>
						        
						        <field name="reservation_line" string="Lignes de Réservation" required="1" colspan="4" nolabel="1"
						            attrs="{'readonly':[('state','not in',('remplir','waiting_confirm'))]}">
									<tree string="Ligne de réservation" editable="top" colors="green:dispo==True;red:dispo==False">
<!-- 										<field name="categ_id"/> -->
										<field name="reserve_product" colspan="1" required="1" context="{'default_openstc_reservable':'1','default_purchase_ok':False}"/>
										<field name="qte_reserves" />
										<field name="qte_dispo"/>
										<field name="dispo" readonly="1"/>
										<field name="amount"/>
										<!-- <field name="uom_qty"/>  -->
										<field name="infos"/>
										<field name="action" readonly="1"/>
										<button name="unplan_inter" type="object" icon="gtk-cancel" attrs="{'invisible':[('action','&lt;&gt;','inter')]}" help="Ne plus plannifier d'intervention pour cette ressource"/>
										<button name="plan_inter" type="object" icon="gtk-go-forward" attrs="{'invisible':[('action','&lt;&gt;','nothing')]}" help="Plannifier une intervention pour cette ressource"/>
										<button name="open_inter" type="object" icon="gtk-edit" attrs="{'invisible':[('action','&lt;&gt;','inter_ok')]}" help="Ouvrir l'intervention générée"/>
										<button name="dummy" icon="gtk-apply" help="Une intervention sera générée pour cette ressource." attrs="{'invisible':[('action','&lt;&gt;','inter')]}"/>  
									</tree>
								</field>
								<field name="state"/>
								<field name="all_dispo" invisible="1"/>
								<newline />
								<group colspan="4" col="10">
									<button name="dummy" string="Vérifier dispo articles" icon="gtk-execute" states="remplir,draft,wait_confirm"/>
									<button name="confirm" string="Valider la réservation" states="remplir,draft" attrs="{'readonly':[('all_dispo','=',False)]}"
									    icon="gtk-go-forward" help="Valide les informations saisies et réserve les ressources sélectionnées aux dates indiquées. La réservation sera visible sur le planning et le demandeur sera notifié par mail (si adresse mail renseignée)."/>
									<button name="confirm" string="Valider la réservation (responsable)" states="wait_confirm" attrs="{'readonly':[('all_dispo','=',False)]}" groups="openstc_prets.openstc_manager,openstc_prets.openstc_dst"
									    icon="gtk-go-forward" help="Valide les informations saisies et réserve les ressources sélectionnées aux dates indiquées. La réservation sera visible sur le planning et le demandeur sera notifié par mail (si adresse mail renseignée)."/>
									<button name="put_in_use_with_intervention" type="object" states="confirm" string="Générer Interventions restantes" icon="gtk-execute" help="Générer les interventions planifiées sur ce formulaire"/>
								    <button name="open_checkout" string="Etat des lieux et clôture" type="object" states="confirm" icon="gtk-go-forward"
								        help="Termine la Réservation, libérant les ressources. Un Etat des lieux sera généré pour pointer l'état des ressources après utilisation."/>
								    <button name="%(action_view_openstc_pret_create_envoi_mail_annulation_wizard)d" string="Annuler la réservation" type="action" states="draft,confirm" icon="gtk-cancel"/>
 									<!-- <button name="to_draft" string="Suivant" states="remplir" icon="gtk-go-forward"/> -->
								    <!-- <button name="put_in_use" string="Planifier" states="confirm" icon="gtk-go-forward" help="La réservation sera visible sur le planning. Si vous avez planifié des interventions, elles vont être générées."/> -->
								    <!-- <button name="redraft" string="Recommencer la réservation" states="cancle" /> -->
									<!-- <button name="verif_dispo" type="object" string="Vérifier Disponibilités" invisible="1" states="remplir" icon="gtk-execute"/> -->
									<!-- <button name="%(action_view_openstc_pret_deliver_products_wizard)d" type="action" string="Mettre à Disposition les articles" states="confirm" icon="gtk-go-forward"/> -->
									<!-- <button name="back_to_remplir" string="Modifier la réservation" icon="gtk-go-back" states="draft"/> -->
									<group colspan="1"/>
									<group col="2" colspan="2">
									    <button name="compute_lines_price" type="object" string="Intégrer Facturation" states="remplir,draft,wait_confirm" icon="gtk-execute" colspan="2"/>
										<field name="amount_total"/>
									</group>
								</group>		        
				       		</page>
				       		<page string="Factures associées (si onéreux)">
	 				      		<field name="folio_id" nolabel="1"/>
	 				   		</page>
			       		</notebook>
			       	</form>
			    </form>
	 		</field><!-- end tag of xml arch -->
		</record>

		<record model="ir.ui.view" id="view_openstock_reservation_tree">
			<field name="name">hotel.reservation.tree</field>
			<field name="model">hotel.reservation</field>
			<field name="inherit_id" ref="hotel_reservation.view_hotel_reservation_tree" />
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<field name="reservation_no" position="replace">
					<field name="name" />
					<field name="reservation_no" string="N° Réservation" />
				</field>
				<field name="partner_id" select="1" position="replace">
					<field name="partner_id" select="1" string="Demandeur" />
				</field>
				<field name="checkin" position="replace">
					<field name="checkin" string="Date de début Réservation" />
				</field>
				<field name="checkout" position="replace">
					<field name="checkout" string="Date de fin Réservation" />
				</field>
			</field>
		</record>

		<record model="ir.ui.view" id="view_openstock_reservation_folio_form">
			<field name="name">open.pret_location.reservation.form</field>
			<field name="model">hotel.folio</field>
			<field name="inherit_id" ref="hotel.view_hotel_folio1_form" />
			<field name="type">form</field>
			<field name="arch" type="xml">
				<!-- @TODO: Rajouter <form> parent pour que les modifs soient prises 
					en compte <field name="checkin_date" position="replace"> <field name="checkin_date" 
					string="Date de début de Réservation"/> </field> <field name="checkout_date" 
					on_change="on_change_checkout(checkin_date,checkout_date)" position="replace"> 
					<field name="checkout_date" on_change="on_change_checkout(checkin_date,checkout_date)" 
					string="Date de fin de Réservation"/> </field> <field name="product_uom_qty" 
					on_change="product_id_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 
					'lang' in context and context['lang'], False, parent.date_order)" context="{'partner_id':'parent.partner_id','quantity':'product_uom_qty','pricelist':'parent.pricelist_id','shop':'parent.shop_id','uom':'product_uom'}" 
					invisible="1" position="replace"> <field name="product_uom_qty" on_change="product_id_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 
					'lang' in context and context['lang'], False, parent.date_order)" context="{'partner_id':'parent.partner_id','quantity':'product_uom_qty','pricelist':'parent.pricelist_id','shop':'parent.shop_id','uom':'product_uom'}" 
					invisible="1" string="Quantité réservée"/> </field> <field name="product_uom" 
					on_change="product_uom_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 
					'lang' in context and context['lang'], False, parent.date_order)" string="Rent(UOM)" 
					position="replace"> <field name="product_uom" on_change="product_uom_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 
					'lang' in context and context['lang'], False, parent.date_order)" string="Unité 
					de Mesure"/> </field> -->
				<field name="service_lines" colspan="4" string="Service Line"
					nolabel="1" position="replace" />
				<field name="room_lines" colspan="4"
					default_get="{'checkin_date': checkin_date,'checkout_date':checkout_date}"
					nolabel="1" position="replace">
					<field name="room_lines" colspan="4"
						default_get="{'checkin_date': checkin_date,'checkout_date':checkout_date}"
						nolabel="1">
						<tree string="Articles Réservés">
							<field name="name" />
							<field name="checkin_date" string="Date de début de Réservation" />
							<field name="checkout_date" string="Date de fin de Réservation" />
							<field name="product_id" context="{'default_openstc_reservable':'1','default_purchase_ok':False}" string="Article Réservé" />
							<field name="product_uom_qty" string="Quantité Réservée" />
							<field name="price_unit" string="Prix Unitaire" />
							<field name="price_subtotal" />
						</tree>
						
					</field>
				</field>
				<field name="partner_id" on_change="onchange_partner_id(partner_id)"
					required="1" string="Guest Name" colspan="4" position="replace">
					<field name="partner_id" on_change="onchange_partner_id(partner_id)"
						required="1" string="Demandeur" colspan="4"/>
				</field>
				<field name="partner_order_id" domain="[('partner_id','=',partner_id)]"
					string="Booking Contact" position="replace">
					<field name="partner_order_id" domain="[('partner_id','=',partner_id)]"
						string="Contact demandeur" />
				</field>
				<field name="name" colspan="1" string="Folio No" position="replace">
					<field name="name" colspan="1" string="N° Folio" />
				</field>
				<field name="shop_id" string="Branch" position="replace">
					<field name="shop_id" string="Magasin" />
				</field>
				<field name="duration" on_change="onchange_dates(checkin_date,False,duration)"
					position="replace" />
				<button name="button_dummy" string="Compute" states="draft"
					type="object" position="replace">
					<button name="button_dummy" string="Calculer" states="draft"
						type="object" />
				</button>
				<button name="order_confirm" string="Confirm Folio" states="draft"
					position="replace">
					<button name="order_confirm" string="Confirmer Folio"
						states="draft" />
				</button>
				<button name="invoice_recreate" string="Recreate Invoice"
					states="invoice_except" position="replace">
					<button name="invoice_recreate" string="Recreate Invoice"
						states="Recréer facture" />
				</button>
				<button name="invoice_corrected" string="Invoice Corrected"
					states="invoice_except" position="replace">
					<button name="invoice_corrected" string="Facture corrigée"
						states="invoice_except" />
				</button>
				<button name="ship_recreate" string="Recreate Procurement"
					states="shipping_except" position="replace">
					<button name="ship_recreate" string="Recréer Approvisionnement"
						states="shipping_except" />
				</button>
				<button name="ship_corrected" string="Procurement Corrected"
					states="shipping_except" position="replace">
					<button name="ship_corrected" string="Approvisionnement Corrigé"
						states="shipping_except" />
				</button>
				<button name="manual_invoice" states="manual" string="Create Invoice"
					position="replace">
					<button name="manual_invoice" states="manual" string="Créer Facture" />
				</button>
				<button name="ship_cancel" string="Cancel Folio" states="shipping_except"
					position="replace">
					<button name="ship_cancel" string="Annuler Folio" states="shipping_except" />
				</button>
				<button name="action_cancel_draft" states="cancel" string="Set to Draft"
					type="object" position="replace">
					<button name="action_cancel_draft" states="cancel"
						string="Mettre en Brouillon" type="object" />
				</button>
				<button name="action_cancel" string="Cancel Folio" states="manual,progress"
					type="object" position="replace">
					<button name="action_cancel" string="Annuler Folio" states="manual,progress"
						type="object" />
				</button>
				<button name="cancel" string="Cancel Folio" states="draft"
					position="replace">
					<button name="cancel" string="Annuler Folio" states="draft" />
				</button>
				<button name="invoice_cancel" string="Cancel Folio" states="invoice_except"
					position="replace">
					<button name="invoice_cancel" string="Annuler Folio" states="invoice_except" />
				</button>
			</field><!-- end tag of xml arch -->
		</record>

		<record model="ir.ui.view" id="view_openstock_reservation_calendar">
			<field name="name">hotel.reservation.calendar</field>
			<field name="model">hotel.reservation</field>
			<field name="inherit_id" ref="hotel_reservation.hotel_calendar_view"/>
			<field name="type">calendar</field>
			<field name="arch" type="xml">
				<xpath expr="//calendar" position="replace">
					<calendar string="Planning des Réservations" color="reservation_line" date_start="checkin" date_stop="checkout" day_length="24" mode="week">
					    <field name="name"/>
					    <field name="partner_id"/>
					    <field name="site_id"/>
					</calendar>
				</xpath>
			</field>
		</record>
		
		<record model="ir.ui.view" id="view_openstock_reservation_line_calendar">
			<field name="name">openstc.hotel.reservation.line.calendar</field>
			<field name="model">hotel_reservation.line</field>
			<field name="type">calendar</field>
			<field name="arch" type="xml">
				<calendar string="Planning des Réservations" color="reserve_product" date_start="checkin" date_stop="checkout" day_length="24" mode="week">
				    <field name="complete_name"/>
				</calendar>
			</field>
		</record>
		
		<record model="ir.ui.view" id="view_openstock_reservation_folio1_tree">
			<field name="name">hotel.folio.tree</field>
			<field name="inherit_id" ref="hotel.view_hotel_folio1_tree" />
			<field name="model">hotel.folio</field>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<field name="checkin_date" position="replace">
					<field name="checkin_date" string="Date de début Réservation" />
				</field>
				<field name="checkout_date" position="replace">
					<field name="checkout_date" string="Date de fin Réservation" />
				</field>
			</field>
		</record>

		<record model="ir.ui.view" id="view_openstc_pret_voir_emprunt_ext">
			<field name="name">purchase.order.emprunt.form</field>
			<field name="model">purchase.order</field>
			<field name="inherit_id" ref="purchase.purchase_order_form" />
			<field name="type">form</field>
			<field name="arch" type="xml">
				<field name="invoiced" position="after">
				    <field name="is_emprunt" invisible="1"/>
				</field>
				<button name="action_cancel" states="approved,except_picking,except_invoice,wait" string="Cancel Purchase Order" type="object" icon="gtk-cancel" position="replace">
					<button name="action_cancel" attrs="{'invisible':['|',('is_emprunt','=',True),('state','not in',('approved','except_picking','except_invoice','wait'))]}" string="Cancel Purchase Order" type="object" icon="gtk-cancel"/>
					<button name="do_terminate_emprunt" type="object" attrs="{'invisible':['|',('is_emprunt','=',False),('state','&lt;&gt;','approved')]}" string="Renvoyer articles à la collecticité" icon="gtk-ok"/>
					<button name="purchase_cancel" attrs="{'invisible':['|',('is_emprunt','=',False),('state','&lt;&gt;','except_picking')]}" string="Annuler emprunt" icon="gtk-cancel"/>
				</button>
			</field>
		</record>

		<record model="ir.ui.view" id="view_openstc_all_reservations_search_view">
			<field name="name">openstc.pret.reservation.all</field>
			<field name="model">hotel.reservation</field>
			<field name="type">search</field>
			<field name="arch" type="xml">
				<search string="Réservations">
					<filter string="En cours de Confirmation" domain="[('state','in',('remplir','draft','wait_confirm'))]" help="Réservations en cours de traitement, elles sont soit en Brouillon, soit en attente de validation."/>
					<filter string="Confirmées mais pas Planifiées" domain="[('state','in',('confirm',))]" help="Réservations validées, le demandeur a été notifié que sa demande est confirmée. Il faut ensuite la planifier."/>
<!-- 					<filter string="Planifiées" domain="[('state','in',('in_use',))]" help="Réservations planifiées sur le planning."/> -->
					<filter string="Terminées" domain="[('state','in',('done',))]" help="Réservations cloturées"/>
					<filter string="Abandonnées" domain="['|',('state','in',('cancle',)),('in_option','=','block')]" help="Réservations annulées ou bloquées pour cause de non disponibilité des articles"/>
					<newline />
					<filter string="Voir seulement les Salles" domain="[('reservation_line.reserve_product.categ_id.name','like','Salles')]"
					    help="n'affiche que les réservations concernant une salle"/>
					<field name="prod_id" string="Ressource" widget="selection"
					    filter_domain="[('reservation_line.reserve_product','=',self)]"/>
				</search>
			</field>
		</record>
		
		<record model="ir.ui.view" id="view_openstc_res_partner_inherit">
			<field name="name">openstc.pret.res.partner.inherit</field>
			<field name="model">res.partner</field>
			<field name="type">form</field>
			<field name="inherit_id" ref="view_openstc_partner_form"/>
			<field name="arch" type="xml">
			    <field name="service_id" position="before">
			        <field name="customer" invisible="1"/>
			        <field name="supplier" invisible="1"/>
			    </field>
				<field name="service_id" position="attributes">
				    <attribute name="invisible">1</attribute>
<!-- 				    <attribute name="attrs">{'invisible':[('customer','=',False)]}</attribute> -->
				</field>    
				<field name="technical_service_id" position="attributes">
				    <attribute name="invisible">1</attribute>
<!-- 				    <attribute name="attrs">{'invisible':[('customer','=',False)]}</attribute> -->
				</field>
				<field name="technical_site_id" position="attributes">
				    <attribute name="attrs">{'invisible':[('supplier','=',True)]}</attribute>
				</field>
		    </field>
		</record>
		
		<!-- Actions Prêts/Locations -->
		<record id="action_openstock_pret_location_view_product" model="ir.actions.act_window">
			<field name="name">Prêts / Locations</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">product.product</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree</field>
		</record>

		<record id="action_open_pret_location_reservation_create_form"
			model="ir.actions.act_window">
			<field name="name">Réserver article(s)</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">hotel.reservation</field>
			<field name="view_type">form</field>
			<field name="view_mode">form</field>
			<field name="src_model">product.product</field>
			<field name="view_id" ref="hotel_reservation.view_hotel_reservation_form" />
			<field name="target">current</field>
			<field name="context">{'from_product':'1', 'product_ids':active_ids,'default_openstc_reservable':'1','default_purchase_ok':False}</field>
		</record>

		<record id="action_openstc_pret_resa_semaine_view" model="ir.actions.act_window">
			<field name="name">Réservations de la semaine à traiter</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">hotel.reservation</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
			<field name="domain">[('state','not in',('cancle','done'))]</field>
			<field name="context">{'resa_semaine':1}</field>
			<field name="target">current</field>
		</record>
		
		<record id="action_open_pret_location_reservation_create_values" model="ir.values">
			<field name="name">Réserver article(s)</field>
			<field name="key2">client_action_multi</field>
			<field eval="1" name="object"/>
			<field name="value" eval="'ir.actions.act_window,' + str(ref('action_open_pret_location_reservation_create_form'))" />
			<field name="key">action</field>
			<field name="model">product.product</field>
		</record>

		<!-- calendar views -->


		
	</data>
</openerp>