<?xml version="1.0" encoding="utf-8"?>
<!--
    OpenSTC Interventions - Openerp Module to manage Cityhall technical department
    Copyright (C) 2013 Siclic www.siclic.fr

    This file is part of OpenSTC Interventions.

    OpenSTC Interventions is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    OpenSTC Interventions is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with OpenSTC Interventions.  If not, see <http://www.gnu.org/licenses/>.
-->
<openerp>
<data noupdate="0">

	<!--  GROUPS -->

	<record id="openstc_employee" model="res.groups">
        <field name="name">Employee</field>
        <field name="category_id" ref="base.module_category_project_management"/>
        <field name="implied_ids" eval="[(4,ref('base.group_user'))]"/>
    </record>

    <record id="openstc_accueil" model="res.groups">
        <field name="name">OpenSTC/Accueil</field>
        <field name="code">RCPT</field>
        <field name="category_id" ref="base.module_category_project_management"/>
        <field name="implied_ids" eval="[(4, ref('openstc_employee'))]"/>
    </record>

    <record id="openstc_agent" model="res.groups">
        <field name="name">OpenSTC/Agent</field>
        <field name="code">OFFI</field>
        <field name="category_id" ref="base.module_category_project_management"/>
        <field name="implied_ids" eval="[(4, ref('openstc_employee')),(4, ref('stock.group_stock_user'))]"/>
    </record>

     <record id="openstc_agent_non_technique" model="res.groups">
        <field name="name">OpenSTC/Agent Non Technique</field>
        <field name="code">PART</field>
        <field name="category_id" ref="base.module_category_project_management"/>
        <field name="implied_ids" eval="[(4, ref('openstc_employee'))]"/>
    </record>


    <!-- <record id="openstc_chef" model="res.groups">
        <field name="name">OpenSTC/Chef d'Ã©quipe</field>
        <field name="category_id" ref="base.module_category_project_management"/>
        <field name="implied_ids" eval="[(4, ref('openstc_employee'))]"/>
    </record>
     -->

    <record id="openstc_qualifier" model="res.groups">
        <field name="name">Qualifier</field>
        <field name="category_id" ref="base.module_category_project_management"/>
        <field name="implied_ids" eval="[(4, ref('openstc_employee'))]"/>
    </record>

    <record id="openstc_dst" model="res.groups">
         <field name="name">OpenSTC/DST</field>
         <field name="code">DIRE</field>
         <field name="category_id" ref="base.module_category_project_management"/>
         <field name="implied_ids" eval="[(4, ref('openstc_qualifier')),(4, ref('stock.group_stock_manager')),(4,ref('analytic.group_analytic_accounting')),(4,ref('account.group_account_user')),(4,ref('purchase.group_purchase_manager')),(4,ref('base.group_sale_manager'))]"/>
    </record>

    <record id="openstc_manager" model="res.groups">
        <field name="name">OpenSTC/Chef de service</field>
        <field name="code">MANA</field>
        <field name="category_id" ref="base.module_category_project_management"/>
        <field name="implied_ids" eval="[(4, ref('openstc_qualifier')),(4, ref('stock.group_stock_manager')),(4,ref('analytic.group_analytic_accounting')),(4,ref('account.group_account_user')),(4,ref('purchase.group_purchase_manager')),(4,ref('base.group_sale_manager'))]"/>
    </record>

     <!--  <delete id="res_users_rule" model="ir.rule"/> -->
	 <record model="ir.rule" id="base.res_users_rule">
        <field name="name">Override base user rule</field>
        <field name="model_id" ref="base.model_res_users" />
        <field name="global" eval="True" />
        <field name="domain_force">[(1,"=",1)]
        </field>
	 </record>
</data>
    <!--  RULES -->

<data noupdate="1">
     <!--  <record model="ir.rule" id="group_rule">
        <field name="name">Group Rule</field>
        <field name="model_id" ref="base.model_res_groups"/>
        <field name="domain_force">[('id','in',[g.id for g in user.groups_id])]</field>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record> -->

	<!-- read access of interventions belongs to services user and interventions create by him -->
    <record model="ir.rule" id="ask_rule">
        <field name="name">Ask Rule</field>
        <field name="model_id" ref="model_openstc_ask"/>
        <field name="domain_force">['|',('service_id','in',[g.id for g in user.service_ids]),('create_uid',"=",user.id)]</field>
        <field eval="[(6,0,[ref('openstc_dst'),ref('openstc_qualifier'),ref('openstc_manager'),ref('openstc_accueil'),ref('openstc_agent')])]" name="groups"/>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>



    <record model="ir.rule" id="ask_non_technique_rule">
        <field name="name">Project Rule non technique</field>
        <field name="model_id" ref="model_openstc_ask"/>
        <field name="domain_force">[('create_uid',"=",user.id)]</field>
        <field eval="[(6,0,[ref('openstc_agent_non_technique')])]" name="groups"/>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>


    <record model="ir.rule" id="project_dst_rule">
        <field name="name">Project Rule</field>
        <field name="model_id" ref="model_project_project"/>
        <field name="domain_force">['|',('service_id','in',[g.id for g in user.service_ids]),('write_uid',"=",user.id)]</field>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>

    <record model="ir.rule" id="service_rule">
        <field name="name">Service Rule</field>
        <field name="model_id" ref="model_openstc_service"/>
        <field name="domain_force">[('id','in',[g.id for g in user.service_ids])]</field>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>


    <!--
    <record model="ir.rule" id="task_rule">
        <field name="name">Task Rule</field>
        <field name="model_id" ref="model_project_task"/>
        <field name="domain_force">['|','|',('create_uid','=',user.id),('user_id','=',user.id),('dst_group_id','in',[g.id for g in user.groups_id])]</field>
        <field eval="1" name="perm_unlink"/>
        <field eval="1" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="1" name="perm_create"/>
    </record>
    -->


    <!--  <record model="ir.rule" id="site_rule">
        <field name="name">Site Rule</field>
        <field name="model_id" ref="model_openstc_site"/>
        <field name="domain_force">[('service','in',[s.id for s in user.service_ids])]</field>
        <field eval="1" name="global"/>
    </record>
    -->

</data>
</openerp>
